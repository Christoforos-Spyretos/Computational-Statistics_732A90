---
title: "Computational Statistics (732A90) Lab03"
author: "Christophoros Spyretos, Marc Braun, Marketos Damigos, Patrick Siegfried Hiemsch & Prakhar"
date: "`r Sys.Date()`"
output: pdf_document
header-includes:
   - \usepackage{mathtools}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
```

# Question 1

## Task 1



# Question 2

```{r}
set.seed(12345)

x <- runif(n=10000, min=0, max=1)
data <- data.frame(unif=x)
```


```{r}

de_distribution = function(m, a, u){
  result <- m-(1/a)*sign(u-0.5)*log(1-2*abs(u-0.5))
  #result <- m-sign(u-0.5)*1/a*log(1+sign(u-0.5)-sign(u-0.5)*2*u)
  return(result)
}

data_de = data.frame(de = de_distribution(0,1, x))

ggplot(data = data_de, aes(x = de)) + 
  geom_histogram(bins = 100, color = "blue", fill = "white", aes(y=..density..))+
  geom_density(colour = "red")+
  ylab("Density")+
  scale_x_continuous(breaks = -10:10)+
  theme_bw()

```



## Question 2

### Task 1
First of all one needs the CDF of DE(x).
$$
\begin{aligned}
DE(x) &= 0.5 \cdot \exp\left( -|x|\right) \\
 F_X(x) &:= \int_{-\infty}^{x}DE(\tilde{x}) d\tilde{x} \\
 &= \int_{-\infty}^{x} 0.5 \cdot \exp\left( -|\tilde{x}|\right) d\tilde{x} &\mbox{For } x >0\\
&\overset{x > 0}{=} 0.5 + \int_{0}^{x} 0.5 \cdot \exp\left( -\tilde{x}\right) d\tilde{x} \\
&= 0.5 \left(1  + \int_{0}^{x} \exp\left( -\tilde{x}\right) d\tilde{x} \right) \\
&= 0.5 \left(1 + \left[ -\exp\left( -\tilde{x}\right) \right]_0^x \right) \\
&= 1- 0.5 \cdot \exp{(-x)} \\
&&\mbox{For } x < 0 \\
F_X(x) &\overset{x < 0}{=} \int_{-\infty}^{x} 0.5 \cdot \exp\left( \tilde{x} \right) d\tilde{x} \\
&= \left[ 0.5 \cdot \exp\left( \tilde{x}\right) \right]_{-\infty}^x \\
&= 0.5 \cdot \exp\left( x\right)
\end{aligned}
$$
Then the inverse of the CDF is needed.
$$
\begin{aligned}
\mbox{For } x > 0 \\
1 -0.5 \cdot exp{ \left( -F_X^{-1}(y) \right)} &= y \\
2 -2 y &= exp{ \left( -F_X^{-1}(y) \right)} \\
-\ln{(2-2y)} &= F_X^{-1}(y) \\
\mbox{For } x < 0 \\
0.5 \cdot exp{ \left( F_X^{-1}(y) \right)} &= y \\
F_X^{-1}(y) &= \ln{(2y)}
\end{aligned}
$$
Then for $U \sim \mbox{Unif}(0,1)$
$$X = F_X^{-1}(U) \sim \mbox{double exponential (0, 1)}$$

```{r}
DE <- function(x) 0.5 * exp(-abs(x))
DE_CDF <- function(x){
  if (x > 0) return(1 - 0.5 * exp(1)^(-x))
  else return(0.5 * exp(1)^x)
}
DE_CDF_invers <- function(y){
  res_pos <- -log(2-2*y)
  if(res_pos > 0) return(res_pos)
  else return(log(2*y))
}
CDF_mehtod <- function(n){
  U <- runif(n)
  return(sapply(U, DE_CDF_invers))
}

data_de = data.frame(de = CDF_mehtod(10000))

ggplot(data = data_de, aes(x = de)) + 
  geom_histogram(bins = 100, color = "blue", fill = "white", aes(y=..density..))+
  geom_density(colour = "red")+
  stat_function(fun = DE, color = "chartreuse4") +
  ylab("Density")+
  scale_x_continuous(breaks = -10:10)+
  theme_bw()

```


### Task 2

To use the acceptance rejection method the functions have to fulfilll the
following condition:

$$
\begin{aligned}
m &\geq \frac{\mathcal{N}(0,1)}{DE(0,1)}   \\
&= \frac{2 \exp{(0.5 \cdot x^2)}}{\sqrt{2 \pi} \cdot \exp(-|x|)} \\
&= \frac{2}{\sqrt{2 \pi}} \cdot \exp{ \left( 0.5 \cdot x^2 - |x| \right)} \\
&\geq \frac{2}{\sqrt{2 \pi}} \cdot \exp{(0.5)}
\end{aligned}
$$
So the majorising constant can be chosen to be $m = \frac{2}{\sqrt{2 \pi}} \cdot \exp{(0.5)}$.

```{r}
rnorm_acc_rej <- function(n){
  DE <- function(x) 0.5 * exp(-abs(x))
  m <- 2 / sqrt(2 * pi) * exp(0.5)
  X <- c()
  counter <- 0
  while (length(X) != n) {
    counter <- counter + 1
    U <- runif(1)
    Y <- CDF_mehtod(1)
    if (U <= dnorm(Y) / (m * DE(Y))) {
      X <- append(X, Y)
    }
  }
  return(list("rnumbers" = X, "rej_rate" = 1 - (n / counter)))
}

data_de = data.frame(de = rnorm_acc_rej(2000)$rnumbers)

ggplot(data = data_de, aes(x = de)) + 
  geom_histogram(bins = 100, color = "blue", fill = "white", aes(y=..density..))+
  geom_density(colour = "red")+
  stat_function(fun = dnorm, color = "chartreuse4") +
  ylab("Density")+
  scale_x_continuous(breaks = -10:10)+
  theme_bw()

```
The expected rejection rate ER is
$$
\begin{aligned}
ER &= 1 - \frac{\int_{-\infty}^{\infty} \frac{1}{\sqrt{2 \pi}} e^{-0.5 \cdot x^2}dx}{m \cdot \int_{-\infty}^{\infty} 0.5 \cdot e^{-|x|} dx} \\
&= 1- \frac{1}{m} \\
&= 1- \frac{1}{\frac{2}{\sqrt{2 \pi}} \cdot e^{(0.5)}} \\
&\approx 23.98 \%
\end{aligned}
$$

The average actual rejection rate for $n=50000$ samples is
```{r}
paste0(as.character(round(rnorm_acc_rej(50000)$rej_rate * 100, 2)), "%")
```